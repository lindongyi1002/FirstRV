## 设计哲学
---
大道至简

## 处理器设计需要了解
---
1. 熟悉汇编语言及其执行过程;
2. 了解软件如何经过编译, 汇编, 链接最后成为处理器可执行的二进制码的过程;
3. 了解计算机体系结构的知识;
4. 处理器设计对时序和面积的要求非常严格, 所以属性框对电路和逻辑设计的理解比较深刻
### 验证特点:
1. 传统UVM;
2. 人工编写或随机生成的汇编语言测试用例在处理器上运行进行验证;
3. 高等语言(C, C++等)编写的测试用例在处理器上验证.

## 基础信息
---
- RISC-V架构文档分为"指令集架构"和"特权架构文档", 可在RISC-V基金会网站免费下载
- 和所有的RISC处理器架构一样, RISC-V架构使用专用的存储器读(Load)指令和存储器写(Store)指令访问存储器(Memory), 其他的普通指令无法访问存储器, 这种架构时RISC架构常用的一个基本策略.

## RISC-V架构的存储器的显著特点
---
- 推荐使用地址对齐的存储器读写操作;
- RISC-V架构仅支持小端格式(Little-Endian)[[小端格式和大端格式(Little-Endian&Big-Endian)]];
- RISC-V架构的存储器不支持读写地址自增自减的模式;
- 采用松散存储器模型;
- 规整的指令编码格式;
- 简化的分支跳转指令与静态预测机制;
- 无分支延迟槽;
- 不使用零开销硬件循环
- 对任何的运算指令错误(包括整数与浮点指令)均不产生异常, 而是产生某个特殊的默认值, 同时设置某些状态存储器的状态位.
- 16位压缩指令有一一对应的普通32位指令;
- 不使用零开销硬件循环;

## 特权模式
    RSIC-V架构定义了3种工作模式, 又称为特权模式(Privileged Mode):
---
- 机器模式(Machine Mode), 简称M Mode;
- 监督模式(Supervisor Mode), 简称S Mode;
- 用户模式(User Mode), 简称U Mode;
其中M Mode为必选, 另外两种为可选.

## CSR寄存器
    控制和状态寄存器(Control and Status Register, CSR)
---
CSR寄存器是处理器核内部的存储器, 使用自己的地址编码空间, 和存储器寻址的地址空间完全无关系;
- 专用的CSR指令有:
    - CSRRW
    - CSRRS
    - CSRRC
    - CSRRWI
    - CSRRSI
    - CSRRCI

## ==推荐使用assign语法代替if-else和case语法==
    - 详见"教你设计CPU--RSIC-V处理器篇"P70;
---
if-else 和case不能传播不定态, 如果输入为X时, 会被等效为低电平, 会掩盖某些bug, 造成芯片功能错误.

## 流水线与状态机
---
- 流水线本质上是以面积换性能, 以空间换时间的手段;
- 状态机则是以性能换面积, 以时间换空间的手段;
- 流水线与状态机的关系可称之为展开与折叠的关系;
- 本质上都是一种电路设计时, 选择侧重时间(性能)还是空间(面积)的一种取舍;

## 蜂鸟E200处理器的流水线结构
    严格来讲蜂鸟E200是一个变长流水线结构, 非严谨的定义流水线深度为二级
---
1. 流水线的第一级为"取址"(由IFU完成);
2. 第二部分包括:
    - "译码"(EXU完成);
    - "执行"(由EXU完成);
    - "写回"(由WB完成);
3. 第三部分:
    - "访存"(由LSU完成);
    - LSU写回的结果还需要通过WB模块写回通用寄存器;

## 取址(Instruction Fetch)
---
    - 每条指令在存储器空间中所处的地址称为它的指令PC(Program Counter). 取址是指处理器核将指令从存储器中读取出来的过程(按照其指令PC值对应的存储器地址).
- ==蜂鸟E200的分支预测采用最简单的静态预测, 使用BTFN预测(Back TAKEN, Forward Not Taken)==:
    - 静态预测是最简单的"方向"预测方法, 其不依赖于任何曾经执行过的指令信息和历史信息, 而是仅依靠这条分支指令本身的信息进行预测;
    - BTFN: 对于向后的跳转(地址减小)预测为跳, 对于向前的跳转(地址增加)预测为不跳.
### 0. IFU总体设计思路:
1. 对取回的指令进行简单译码(Mini-Decode);
2. 简单的分支预测(Simple-BPU);
3. 生成取址的PC;
4. 根据PC的地址访问ITCM或BIU;
### 1. Mini-Decode
    - 此处的译码并不需要完整的译出指令的所有信息, 而只需要译出IFU所需的部分指令信息即可;
    - 代码存放在'e200_opensource/rtl/e203/core/e203_ifu_minidec.v'.
- Mini-Decode模块内部也是例化调用完整的Decode模块, 知识将不相关的输入信号接0, 输出信号悬空不连接.
### 2. Simple-BPU分支预测
    - E200使用最简单的静态预测, 向后跳转预测为跳, 向前预测为不跳;
    - 'core/e203_ifu_litebpu'
- 由于PC计算需要用到加法器, 为了节省面积, 所有的PC季孙均共享一个加法器;